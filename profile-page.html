<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile Page</title>
<link rel="stylesheet" href="style2.css">
<style>
  body {
    font-family: Montserrat, sans-serif;
    background-color: white;
    margin: 0;
    padding: 0;
  }
</style>

</head>
<body>

<div class="profile-container">
  <div class="profile-heading">Profile</div>
  <div class="profile-pic-container">
  <img id="profilePic" src="img/Rectangle.png" alt="Profile Picture">
  <input type="file" id="picUpload" accept="image/*" style="display:none;">
  
</div>
<button type="button" class="change" onclick="document.getElementById('picUpload').click()">Change Picture</button>
<br>
  <div class="profile-name" id="profileName">John Doe</div>

  <!-- Editable info -->
  <div class="profile-info">
    <div>Email: <span id="profileEmail"></span></div>
    <div>Phone: <span id="profilePhone"></span></div>
    <div>Emergency Contact: <span id="profileEmergencyName"></span> - <span id="profileEmergencyPhone"></span></div>
    <div>Address: <span id="profileAddress"></span></div>
    <div>City: <span id="profileCity"></span></div>
    <div>Panic PIN: <span id="profilePanicPin"></span></div>
  </div>

  <!-- Edit buttons -->
  <button class="profile-button" onclick="editInfo()">Edit My Information <span class="arrow">→</span></button>
  <button class="profile-button" onclick="editEmergency()">Edit Emergency Contact <span class="arrow">→</span></button>
  <button class="profile-button" onclick="editPanicPin()">Edit Panic PIN <span class="arrow">→</span></button>
  <button class="profile-button logout-button" onclick="logout()">Log Out <span class="arrow">→</span></button>
  
</div>

<!-- Hidden edit forms -->
<div id="editModal" style="display:none; background:#fff; padding:20px; border:1px solid #ccc;">
  <h3>Edit Information</h3>
  <form id="editForm">
    <label>First Name</label>
    <input type="text" id="editFirstName"><br>
    <label>Last Name</label>
    <input type="text" id="editLastName"><br>
    <label>Email</label>
    <input type="email" id="editEmail"><br>
    <label>Phone</label>
    <input type="text" id="editPhone"><br>
    <button type="submit">Save</button>
    <button type="button" onclick="closeModal()">Cancel</button>
  </form>
</div>

<div id="editEmergencyModal" style="display:none; background:#fff; padding:20px; border:1px solid #ccc;">
  <h3>Edit Emergency Contact</h3>
  <form id="editEmergencyForm">
    <label>Contact Name</label>
    <input type="text" id="editEmergencyName"><br>
    <label>Contact Phone</label>
    <input type="text" id="editEmergencyPhone"><br>
    <button type="submit">Save</button>
    <button type="button" onclick="closeEmergencyModal()">Cancel</button>
  </form>
</div>

<div id="editPanicModal" style="display:none; background:#fff; padding:20px; border:1px solid #ccc;">
  <h3>Edit Panic PIN</h3>
  <form id="editPanicForm">
    <label>New 4-digit Panic PIN</label>
    <input type="password" id="editPanicPin" maxlength="4" required><br>
    <button type="submit">Save</button>
    <button type="button" onclick="closePanicModal()">Cancel</button>
  </form>
</div>

<script>
    // Load profile dat from loacal storage
window.addEventListener('DOMContentLoaded', () => {
  const userProfile = JSON.parse(localStorage.getItem('userProfile'));
  if(userProfile){
    // Populate profile fields
    document.getElementById('profileName').innerText = `${userProfile.Firstname} ${userProfile.Lastname}`;
    document.getElementById('profileEmail').innerText = userProfile.email;
    document.getElementById('profilePhone').innerText = userProfile.phone;
    document.getElementById('profileEmergencyName').innerText = userProfile.EmergencyContactName;
    document.getElementById('profileEmergencyPhone').innerText = userProfile.EmergencyContact;
    document.getElementById('profileAddress').innerText = userProfile.address;
    document.getElementById('profileCity').innerText = userProfile.city;
    document.getElementById('profilePanicPin').innerText = userProfile.panicPin;
  }
});

// Open edit modals
function editInfo() {
  const userProfile = JSON.parse(localStorage.getItem('userProfile')) || {};
  document.getElementById('editFirstName').value = userProfile.Firstname || '';
  document.getElementById('editLastName').value = userProfile.Lastname || '';
  document.getElementById('editEmail').value = userProfile.email || '';
  document.getElementById('editPhone').value = userProfile.phone || '';
  document.getElementById('editModal').style.display = 'block';
}

function editEmergency() {
  const userProfile = JSON.parse(localStorage.getItem('userProfile')) || {};
  document.getElementById('editEmergencyName').value = userProfile.EmergencyContactName || '';
  document.getElementById('editEmergencyPhone').value = userProfile.EmergencyContact || '';
  document.getElementById('editEmergencyModal').style.display = 'block';
}

// Close modals
function closeModal() { document.getElementById('editModal').style.display = 'none'; }
function closeEmergencyModal() { document.getElementById('editEmergencyModal').style.display = 'none'; }

// Save edits
document.getElementById('editForm').addEventListener('submit', (e) => {
  e.preventDefault();
  let userProfile = JSON.parse(localStorage.getItem('userProfile')) || {};
  userProfile.Firstname = document.getElementById('editFirstName').value;
  userProfile.Lastname = document.getElementById('editLastName').value;
  userProfile.email = document.getElementById('editEmail').value;
  userProfile.phone = document.getElementById('editPhone').value;
  localStorage.setItem('userProfile', JSON.stringify(userProfile));
  location.reload(); // Refresh page to show updated info
});

document.getElementById('editEmergencyForm').addEventListener('submit', (e) => {
  e.preventDefault();
  let userProfile = JSON.parse(localStorage.getItem('userProfile')) || {};
  userProfile.EmergencyContactName = document.getElementById('editEmergencyName').value;
  userProfile.EmergencyContact = document.getElementById('editEmergencyPhone').value;
  localStorage.setItem('userProfile', JSON.stringify(userProfile));
  location.reload();
});
// Open Panic PIN modal
function editPanicPin() {
  const userProfile = JSON.parse(localStorage.getItem('userProfile')) || {};
  document.getElementById('editPanicPin').value = userProfile.panicPin || '';
  document.getElementById('editPanicModal').style.display = 'block';
}

// Close Panic PIN modal
function closePanicModal() {
  document.getElementById('editPanicModal').style.display = 'none';
}

// Save Panic PIN
document.getElementById('editPanicForm').addEventListener('submit', (e) => {
  e.preventDefault();
  let userProfile = JSON.parse(localStorage.getItem('userProfile')) || {};
  const newPin = document.getElementById('editPanicPin').value.trim();

  if(newPin.length !== 4) {
    alert("Panic PIN must be 4 digits!");
    return;
  }

  userProfile.panicPin = newPin;
  localStorage.setItem('userProfile', JSON.stringify(userProfile));
  location.reload(); // Refresh to show updated PIN
});
const profilePic = document.getElementById('profilePic');
  const picUpload = document.getElementById('picUpload');

  // Load saved picture if available
  const savedPic = localStorage.getItem('profilePic');
  if (savedPic) {
    profilePic.src = savedPic;
  }

  // Handle new upload
  picUpload.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(event) {
        const imageData = event.target.result;

        // Save to localStorage
        localStorage.setItem('profilePic', imageData);

        // Update UI
        profilePic.src = imageData;
      };
      reader.readAsDataURL(file);
    }
  });


// Log out
function logout() {
  // Instead of deleting the user profile, just mark as logged out
  localStorage.setItem('isLoggedIn', 'false'); 

  // Optional: you can also clear session-only things
  // sessionStorage.clear();

  window.location.href = 'index.html';
}

</script>
</body>
</html>
